<MudDialog>
    <DialogContent>
        <div class="d-flex align-center justify-space-between">
            <div class="left-side">
                @if (RoomId is null)
                {
                    <MudText Typo="Typo.h6">Add Room</MudText>
                }
                else
                {
                    <MudText Typo="Typo.h6">Edit Room</MudText>
                }
            </div>

            <div class="right-side">
                <MudIconButton Icon="@Icons.Material.Filled.Close"
                               Color="Color.Default"
                               Variant="Variant.Text"
                               OnClick="Cancel" />
            </div>
        </div>

        <MudForm @ref="_form">
            <MudGrid Spacing="6">

                <MudItem xs="12">
                    <MudTextField @bind-Value="Room.Name"
                                  Label="Name"
                                  Required
                                  MaxLength="10"
                                  RequiredError="Name is required" />
                </MudItem>

                <MudItem xs="12">
                    <MudTextField @bind-Value="Room.Feature"
                                  Label="Feature" />
                </MudItem>

                <MudItem xs="12">
                    <MudNumericField T="decimal"
                                     @bind-Value="Room.BaseHourlyRate"
                                     Label="Base Hourly Rate"
                                     Required
                                     Min="0" />
                </MudItem>

                <MudItem xs="12">
                    <MudSelect T="M.RoomStatus"
                               @bind-Value="Room.Status"
                               Label="Status">
                        @foreach (var status in Enum.GetValues<M.RoomStatus>())
                        {
                            <MudSelectItem Value="status">@status</MudSelectItem>
                        }
                    </MudSelect>
                </MudItem>

                <MudItem>
                    <MudSwitch LabelPlacement="Placement.Top"  Label="Inactive" @bind-Value="Room.InActive"
                               Color="Color.Error" />
                </MudItem>



            </MudGrid>
        </MudForm>

        <MudButton Variant="Variant.Filled" Class="core-bg-color float-right w-200px"
                   OnClick="Save">
            <MudText Class="text-white">Save</MudText>
        </MudButton>

    </DialogContent>
</MudDialog>

@code {
    [CascadingParameter]
    public IMudDialogInstance MudDialog { get; set; } = null!;

    [Parameter]
    public int? RoomId { get; set; }
    private M.Room Room { get; set; } = new();

    private MudForm _form = default!;

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if(firstRender)
        {
            await GetData();
            await InvokeAsync(StateHasChanged);
        }
        await base.OnAfterRenderAsync(firstRender);
    }


    private async Task GetData()
    {
        try
        {
            if (RoomId is not null)
            {
                var param = new M.IdParam() { Id = RoomId ?? 0, VenueId = 4 };
                Room = await RoomAPI.GetByIdAsync(param) ?? new M.Room();
            }
            else
            {
                Room = new();
                Room.CreatedAt = DateTime.UtcNow;
                Room.Status = M.RoomStatus.Available;
                Room.InActive = false;
                Room.VenueId = 4;
            }
        }
        catch
        {
            
        }
    }

    private void Cancel()
    {
        MudDialog.Cancel();
    }

    private async Task Save()
    {
        await _form.Validate();

        if (!_form.IsValid)
            return;

        MudDialog.Close(DialogResult.Ok(Room));
    }
}

